<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>MapLibre + Chart.js Example</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    body { margin:0; padding:0; }
    #map { position:absolute; top:0; bottom:50%; width:100%; }
    #chart { position:absolute; bottom:0; height:50%; width:100%; }
  </style>
</head>
<body>
<div id="map"></div>
<canvas id="chart"></canvas>
<script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const map = new maplibregl.Map({
    container: 'map',
    style: 'https://demotiles.maplibre.org/style.json',
    center: [102.0, 0.5],
    zoom: 3
  });

  fetch('http://localhost:5000/collections/points/items?f=json')
    .then(r => r.json())
    .then(data => {
      map.on('load', () => {
        map.addSource('points', {
          type: 'geojson',
          data: data
        });
        map.addLayer({
          id: 'points-layer',
          type: 'circle',
          source: 'points',
          paint: { 'circle-radius': 8, 'circle-color': '#007cbf' }
        });
      });

      const labels = data.features.map(f => f.properties.name);
      const chartData = data.features.map((f, i) => i + 1);
      new Chart(document.getElementById('chart'), {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{ label: 'Sample', data: chartData }]
        }
      });
    });
</script>
</body>
</html>
